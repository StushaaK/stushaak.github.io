function run(){checkVersion(),checkWorking(),setVersion(),makeItPretty(),showSettings(),turnOnHotkeys(),hotkeysOnOff(),0!=userset[s.enable_auto_run]&&applySettings()}function checkVersion(){if(getVersion()!=version)if(buttons=[{text:"OK",callback:null,confirm:!0}],clearProfiles){var b=$.jStorage.get("profileList");$.each(b,function(c,a){$.jStorage.deleteKey("profile:"+a)}),$.jStorage.set("keyPressSettings",keyPressSettings),Dialog.show("update_dialog","This script has recently been updated to version <span style='font-weight:bold;'>"+version+"</span> and in order for the new version to work, all profiles and settings must be reset. Sorry for any inconvenience.<br /><br/><a href='"+updateNotesURL+"' target='_blank'>See what's new</a>")}else Dialog.show("update_dialog","This script has recently been updated to version <span style='font-weight:bold;'>"+version+"</span><br /><br/><a href='"+updateNotesURL+"' target='_blank'>See what's new</a>")}function checkWorking(){var b=$.jStorage.get("working");null==b&&$.jStorage.set("working",!1),getVersion()!=version&&$.jStorage.set("working",!1),0==working&&0==b&&(buttons=[{text:"OK",callback:null,confirm:!0}],UI.ConfirmationBox("An error has been discovered in this version. You may continue testing the script if you haven't noticed the error.",buttons,!1,[]),$.jStorage.set("working",!0))}function setVersion(){$.jStorage.set("version",version)}function getVersion(){var b=$.jStorage.get("version");return null==b?(setVersion(),version):b}function showAllRows(){var b=$.trim($("#plunder_list_nav tr:first td:last").children().last().html().replace(/\D+/g,""));"max"==$("#end_page").val()&&$("#end_page").text(b),$("#am_widget_Farm tr:last").remove(),b>parseInt($("#end_page").val(),10)&&(b=parseInt($("#end_page").val(),10)),setTimeout(function(){getPage(parseInt($("#start_page").val(),10)-1,b)},1)}function getPage(d,a){if(a>d){changeHeader(filter_41+" "+(d+1)+"/"+a+" <img src='graphic/throbber.gif' height='24' width='24'></img>");var b=link[0]+window.game_data.village.id+"&order="+userset[s.order_by]+"&dir="+userset[s.direction]+"&Farm_page="+d+"&screen=am_farm";$.ajax({type:"GET",url:b,dataType:"html",error:function(d,a,b){console.log("Get page failed with error: "+b)},success:function(b){console.log($(b)),$("#plunder_list tr",b).slice(1).each(function(){$("#plunder_list tr:last").after("<tr>"+$(this).html()+"</tr>")}),setTimeout(function(){getPage(d+1,a)},1)}})}else setTimeout(function(){addTableInfo(),applyFilters(),changeHeader(filter_40),highlightRows()},1),$("#plunder_list").show(),Accountmanager.initTooltips(),pagesLoaded=!0,cansend=!0}function changeHeader(b){$("h3:first").html(b)}function highlightRows(){$("#am_widget_Farm table").each(function(){$("tr:even:gt(0) td",this).not("table:first").css("backgroundColor","#FFF5DA"),$("tr:odd:gt(0) td",this).not("table:first").css("backgroundColor","#F0E2BE")})}function getNewVillage(c){"n"==c?UI.InfoMessage("Switching to next village...",500):UI.InfoMessage("Switching to previous village...",500),window.onkeydown=function(){},cansend=!1,filtersApplied=!1,Timing.pause(),fadeThanksToCheese(),openLoader();var a=link[0]+c+window.game_data.village.id+link[1];$.ajax({type:"GET",url:a,dataType:"html",error:function(c,a){alert("Error: "+a),$("#fader").remove(),$("#loaders").remove()},success:function(d){var a=$(d),b=d.split("<title>")[1].split("</title>")[0];window.game_data=$.parseJSON(d.split("updateGameData(")[1].split("});")[0]+"}"),$("#header_info").html($("#header_info",a).html()),$("#topContainer").html($("#topContainer",a).html()),$("#contentContainer").html($("#contentContainer",a).html()),$("#quickbar_inner").html($("#quickbar_inner",a).html()),$("head").find("title").html(b),$("#fader").remove(),$("#loaders").remove(),Timing.resetTickHandlers(),Timing.pause(),pagesLoaded=!1,cansend=!1,run()}})}function showSettings(){$("head").append("<link type='text/css' rel='stylesheet' href='"+scriptURL+"css/style.css' />"),$("#contentContainer h3").eq(0).after($("<div class='vis'id='settingsDiv'><table class='settingsTable'><thead><tr><th colspan='5'class='vis'style='padding:0px;'><h4>"+filter_01+" "+version+" - <a href='http://forum.tribalwars.net/showthread.php?266604-ntoombs19-s-FA-Filter'target='_blank'>"+filter_02+"</a> - "+filter_42+": <select id='language'style='margin:0px;'onchange='loadLanguage($(&quot;#language&quot;).val())'></select><span style='font-size:10px;float:right;font-weight:normal;font-style:normal'>"+filter_03+" <a href='http://forum.tribalwars.net/member.php?22739-ntoombs19'target='_blank'>ntoombs19</a>&nbsp;<div class='vis'style='float:right;text-align:center;line-height:100%;width:12px;height:12px;margin:0px 0px 0px 0px;position:relative;background-color:tan;opacity:.7'><a href='#'num='2'onclick='uglyHider($(this));return false;'>-</a></div></span></h4></th></tr></thead><tbody id='settingsBody'><tr><td class='col1'style='min-width:200px'><span>"+filter_04+"</span>&nbsp;<input type='text'value=''size='2'maxlength='3'id='start_page'>&nbsp;<span>"+filter_05+"</span>&nbsp;<input type='text'value=''size='2'maxlength='3'id='end_page'></td><td colspan='3'><span style='font-weight:bold'>"+filter_06+"</span>&nbsp;<img src='graphic/questionmark.png'width='13'height='13'id='enable_help'></td><td rowspan='5'valign='top'><form><input type='checkbox'id='all_none'>&nbsp;<label for='all_none'style='font-weight:bold'>"+filter_07+"</label>&nbsp;<img src='graphic/questionmark.png'width='13'height='13'id='report_help'><br><input type='checkbox'id='blue'><label for='blue'><img src='graphic/dots/blue.png'>&nbsp;"+filter_08+"</label><br><input type='checkbox'id='green'><label for='green'><img src='graphic/dots/green.png'>&nbsp;"+filter_09+"</label><br><input type='checkbox'id='yellow'><label for='yellow'><img src='graphic/dots/yellow.png'>&nbsp;"+filter_10+"</label><br><input type='checkbox'id='red_yellow'><label for='red_yellow'><img src='graphic/dots/red_yellow.png'>&nbsp;"+filter_11+"</label><br><input type='checkbox'id='red_blue'><label for='red_blue'><img src='graphic/dots/red_blue.png'>&nbsp;"+filter_12+"</label><br><input type='checkbox'id='red'><label for='red'><img src='graphic/dots/red.png'>&nbsp;"+filter_13+"</label></form></td></tr><tr><td rowspan='2'><label for='order_by'>"+filter_14+":</label>&nbsp;<select id='order_by'val='distance'><option value='distance'>"+filter_15+"</option><option value='date'>"+filter_16+"</option></select><br><label for='direction'>"+filter_17+":</label>&nbsp;<select id='direction'val='desc'><option value='asc'>"+filter_18+"</option><option value='desc'>"+filter_19+"</option></select></td><td style='width:26px'><input type='checkbox'id='enable_hauls'></td><td style='width:110px'><label for='enable_hauls'>"+filter_20+"</label></td><td><input type='radio'name='hauls'id='full'><label for='full'><img src='graphic/max_loot/1.png'>"+filter_21+"</label>&nbsp;<input type='radio'name='hauls'id='partial'><label for='partial'><img src='graphic/max_loot/0.png'>"+filter_22+"</label></td></tr><tr><td><input type='checkbox'id='enable_attacks'></td><td><label for='enable_attacks'>"+filter_23+"</label></td><td><select id='attack_operator'><option value='greater_than'>"+filter_24+"</option><option value='less_than'>"+filter_25+"</option><option value='equal_to'>"+filter_26+"</option></select>&nbsp;<input type='text'id='attack_value'size='2'maxlength='2'value=''></td></tr><tr><td rowspan='1'><span style='font-weight:bold;'>"+filter_43+"</span></td><td><input type='checkbox'id='enable_walls'></td><td><label for='enable_walls'>"+filter_30+"</label></td><td><select id='wall_operator'><option value='greater_than'>"+filter_24+"</option><option value='less_than'>"+filter_25+"</option><option value='equal_to'>"+filter_26+"</option></select>&nbsp;<input type='text'id='wall_value'size='2'maxlength='2'value=''></td></tr><tr><td><input type='checkbox'id='next_village_no_farms'><label for='next_village_no_farms'>"+filter_39+"</label></td><td><input type='checkbox'id='enable_distances'></td><td><label for='enable_distances'>"+filter_31+"</label></td><td><select id='distance_operator'val='greater_than'><option value='greater_than'>"+filter_24+"</option><option value='less_than'>"+filter_25+"</option><option value='equal_to'>"+filter_26+"</option></select>&nbsp;<input type='text'id='distance_value'size='2'maxlength='2'value=''></td></tr><tr><td><input type='checkbox' id='next_village_units' />"+filter_44+"</td><td><input type='checkbox' id='enable_continents' /><td colspan='3'><select id='continent_display'><option value='hide'>"+filter_32+"</option><option value='show'>"+filter_33+"</option></select>&nbsp;<label for='continents_list'>"+filter_34+"</label>&nbsp;<input type='text'size='2'maxlength='150'id='continents_list'value=''>&nbsp;<img src='graphic/questionmark.png'height='13'id='continent_help'></td></tr><tr><td><input type='checkbox' id='next_village_scouts' /><input type='text' size='2' id='scouts_left' /> "+filter_45+"</td><td><input type='checkbox'id='enable_scout'></td><td colspan='3'><label for='enable_scout'>"+filter_35+"</label>&nbsp;<select id='scout_report_operator'val='greater_than'><option value='greater_than'>"+filter_24+"</option><option value='less_than'>"+filter_25+"</option><option value='equal_to'>"+filter_26+"</option></select>&nbsp;<input type='text'id='haul_value'size='9'maxlength='7'value=''></td></tr><tr><td><input type='checkbox' id='next_village_farming_troops' /><input type='text' size='2' id='farming_troops_left' /> "+filter_46+"</td><td><input type='checkbox'id='enable_time'></td><td colspan='3'><select id='attack_time_filter'val='hide'><option value='hide'>"+filter_32+"</option><option value='show'>"+filter_33+"</option></select>&nbsp;<label for='enable_time'>"+filter_36+"</label>&nbsp;<input type='text'id='time_value'size='2'maxlength='4'value=''><span>"+filter_37+"</span></td></tr><tr><td><input type='checkbox'id='enable_auto_run'><label for='enable_autoRun'>"+filter_38+"</label></td><td><input type='checkbox' id='hide_recent_farms' /></td><td colspan='3'><select id='sent_time_filter'val='hide'><option value='hide'>"+filter_32+"</option><option value='show'>"+filter_33+"</option></select>&nbsp;"+filter_47+" <input type='text' size='2' id='hide_recent_time' /> "+filter_48+"</td></tr><tr><th>"+filter_49+"</th><th colspan='4'>"+filter_50+"</th></tr><tr><td rowspan='4'><table><tr class='hotkey_values'><td><a href='#'onclick='return setKeyEditMode(\"A\")'id='button_a'class='farm_icon farm_icon_a'></a></td><td><a href='#'onclick='return setKeyEditMode(\"B\")'id='button_b'class='farm_icon farm_icon_b'></a></td><td><a href='#'onclick='return setKeyEditMode(\"C\")'id='button_c'class='farm_icon farm_icon_c'></a></td><td><a href='#'onclick='return setKeyEditMode(\"Master\")'id='button_master'class='farm_icon farm_icon_m'></a></td></tr><tr class='hotkey_values'><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_a'value='A'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_b'value='B'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_c'value='C'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_master'value='M'></td></tr><tr class='hotkey_values'><td colspan='2'><input class='btn tooltip'onclick='return setKeyEditMode(\"Skip\")'type='button'value='Skip'style='margin:0px 0px 0px 0px'title='"+filter_51+"'></td><td><input class='btn tooltip'onclick='return setKeyEditMode(\"Left\")'type='button'value='\u21DA'style='margin:0px 0px 0px 0px'title='"+filter_52+"'></td><td><input class='btn tooltip'type='button'onclick='return setKeyEditMode(\"Right\")'value='\u21DB'style='margin:0px 0px 0px 0px'title='"+filter_53+"'></td></tr><tr class='hotkey_values'><td colspan='2'><input type='text'class='hotkey_value' READONLY id='hotkey_value_skip'value='S'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_left'value='&#8592;'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_right'value='&#8594;'></td></tr></table></td><td><input type='checkbox' onchange='return updateKeypressSettings();' id='priorityOneEnabled'/></td><td colspan='3'>"+filter_54+" <select id='priorityOneProfile' onchange='return updateKeypressSettings();'></select> "+filter_55+" <select id='priorityOneButton' onchange='return updateKeypressSettings();'><option val='"+filter_56+"'>"+filter_56+"</option><option val='"+filter_57+"'>"+filter_57+"</option><option val='"+filter_58+"'>"+filter_58+"</option><option val='"+filter_59+"'>"+filter_59+"</option></select></td></tr><tr><td><input type='checkbox' onchange='return updateKeypressSettings();' id='priorityTwoEnabled'/></td><td colspan='3'>"+filter_54+" <select id='priorityTwoProfile' onchange='return updateKeypressSettings();'></select> "+filter_55+" <select id='priorityTwoButton' onchange='return updateKeypressSettings();'><option val='"+filter_56+"'>"+filter_56+"</option><option val='"+filter_57+"'>"+filter_57+"</option><option val='"+filter_58+"'>"+filter_58+"</option><option val='"+filter_59+"'>"+filter_59+"</option></select></td></tr><tr><td><input type='checkbox' onchange='return updateKeypressSettings();' id='priorityThreeEnabled'/></td><td colspan='3'>"+filter_54+" <select id='priorityThreeProfile' onchange='return updateKeypressSettings();'></select> "+filter_55+" <select id='priorityThreeButton' onchange='return updateKeypressSettings();'><option val='"+filter_56+"'>"+filter_56+"</option><option val='"+filter_57+"'>"+filter_57+"</option><option val='"+filter_58+"'>"+filter_58+"</option><option val='"+filter_59+"'>"+filter_59+"</option></select></td></tr><tr><td colspan='4'>"+filter_60+" <select id='defaultButton' onchange='return updateKeypressSettings();'><option val='"+filter_56+"'>"+filter_56+"</option><option val='"+filter_57+"'>"+filter_57+"</option><option val='"+filter_58+"'>"+filter_58+"</option><option val='"+filter_59+"'>"+filter_59+"</option></select></td></tr><tr><td colspan='5'><div style='float:left'><input type='submit'value='"+profile_02+"'onclick='applySettings()'>&nbsp;<input type='submit'value='"+profile_03+"'onclick='resetTable()'></div><div style='float:right'><img src='graphic/questionmark.png'width='13'height='13'id='profile_help'>&nbsp;<label for='settingsProfile'>"+profile_01+":</label>&nbsp;<select id='settingsProfile'onchange='changeProfile($(&quot;#settingsProfile&quot;).val())'></select>&nbsp;<input type='submit'value='"+profile_04+"'onclick='createProfile()'>&nbsp;<input type='submit'value='"+profile_05+"'onclick='setDefaultProfile()'>&nbsp;<input type='submit'value='"+profile_06+"'onclick='deleteProfile()'>&nbsp;<input type='submit'value='"+profile_07+"'onclick='updateProfile()'>&nbsp;<input type='submit'value='"+profile_08+"'onclick='exportProfile()'>&nbsp;<input type='submit'value='"+profile_09+"'onclick='importProfile()'></div></td></tr></tbody></table></div>")),formatSettings(),addLanguages(),$("#language option[value='"+$.jStorage.get("language")+"']").attr("selected","selected")}function formatSettings(){$("#all_none").bind("click",function(){$(this).closest("form").find(":checkbox").prop("checked",this.checked)});var f=$("#report_help");f.attr("title",instructions_01),UI.ToolTip(f);var a=$("#enable_help");a.attr("title",instructions_02),UI.ToolTip(a);var b=$("#continent_help");b.attr("title",instructions_03),UI.ToolTip(b);var c=$("#recent_help");c.attr("title",instructions_04),UI.ToolTip(c);var d=$("#profile_help");d.attr("title",instructions_05),UI.ToolTip(d),loadDefaultProfile(),fillProfileList(),fillMasterSettings(),fillKeypressSettings()}function removeFirstPage(){$("#plunder_list tr:gt(0)").remove(),$("#plunder_list_nav").hide()}function customSendUnits(f,g,b,h){if(!checkIfNextVillage()){if(h.closest("tr").hide(),f=$(f),f.hasClass("farm_icon_disabled"))return!1;var c={target:g,template_id:b,source:game_data.village.id};return $.post(Accountmanager.send_units_link,c,function(b){if(b.error){if(userset[s.next_village_units]&&"Not enough units available"===b.error)return cansend&&filtersApplied&&getNewVillage("n"),!1;UI.ErrorMessage(b.error),h.closest("tr").show()}else{if(setLocalStorageRow(g),"undefined"!=typeof $(h).prop("tooltipText"))var a=$(h).prop("tooltipText");var c=$("<div></div>").append($(a)),d=($(c).find("img[src*=\"res.png\"]").eq(0).attr("src"),a.split("<br />"));d.splice(d.length-2,1),UI.SuccessMessage(d.join(" "),100),Accountmanager.farm.updateOwnUnitsAvailable(b.current_units)}},"json"),!1}}function customSendUnitsFromReport(e,g,b,h){if(!checkIfNextVillage()){if(h.closest("tr").hide(),e=$(e),e.hasClass("farm_icon_disabled"))return!1;return $.post(Accountmanager.send_units_link_from_report,{report_id:b},function(b){if(b.error){if(userset[s.next_village_units]&&"Not enough units available"===b.error)return cansend&&filtersApplied&&getNewVillage("n"),!1;UI.ErrorMessage(b.error),h.closest("tr").show()}else if(setLocalStorageRow(g),"string"==typeof b.success){if("undefined"!=typeof $(h).prop("tooltipText"))var a=$(h).prop("tooltipText");var c=$("<div></div>").append($(a)),d=($(c).find("img[src*=\"res.png\"]").eq(0).attr("src"),a.split("<br />"));d.splice(d.length-2,1),UI.SuccessMessage(d.join(" "),100),Accountmanager.farm.updateOwnUnitsAvailable(b.current_units)}},"json"),!1}}function setOnclick(e){var a=e.find("a").attr("onclick");if("undefined"!=typeof a){var b=a.slice(a.indexOf("(")+1,a.indexOf(")")),c=b.split(",");-1==a.indexOf("FromReport")?e.find("a").attr("onclick","return customSendUnits("+b+", $(this))"):e.find("a").attr("onclick","return customSendUnitsFromReport("+b+"))"),e.closest("tr").attr("name",$.trim(c[1]))}}function addTableInfo(){$("#am_widget_Farm tr th").slice(0,1).after("<th></th>"),$("#am_widget_Farm tr:not(:first-child)").each(function(f){$(this).children("td").each(function(a){switch(a){case 1:$(this).filter(":first").before("<td style='width:10px;font-weight:bold;' id='rowNum'>"+(f+1)+"</td>");break;case 3:var b=$(this).find("img"),c=$(this).find("img").prop("tooltipText");if("undefined"!=typeof c){var d=c.replace(/\D/g,"");b.after("<span style='font-weight:bold;'> ("+d+")</span>")}break;case 8:setOnclick($(this));break;case 9:setOnclick($(this));break;case 10:setOnclick($(this));}})})}function checkIfNextVillage(){if(current_units=Accountmanager.farm.current_units,userset[s.next_village_scouts]){var c=current_units.spy;if(c<=parseInt(userset[s.scouts_left]))return getNewVillage("n"),!0}if(userset[s.next_village_farming_troops]){var a=0;if($(".fm_unit input:checked").each(function(){var b=$(this).attr("name");a+=parseInt(current_units[b])}),a<=parseInt(userset[s.farming_troops_left]))return getNewVillage("n"),!0}return userset[s.next_village_no_farms]&&0==$("#plunder_list tr:not(:first-child):visible").length?(getNewVillage("n"),!0):void 0}function applySettings(){pagesLoaded?applyFilters():(setTimeout(showAllRows(),1),removeFirstPage())}function applyFilters(){$("#am_widget_Farm tr:gt(0)").each(function(){hideRow=checkRowToHide($(this),userset),hideRow&&$(this).hide()}),changeHeader(filter_40);var b=0;"fixed"==$("#topContainer").css("position")&&(b=$("#topContainer").height()),$("*:contains(\"Bot Protection\")").length?($("html, body").animate({scrollTop:$("*:contains(\"Bot Protection\")").offset().top-b},500),cansend=!1):$("html, body").animate({scrollTop:$("#farm_units").offset().top-b},500),filtersApplied=!0}function checkRowToHide(c,d){return hideRow=!1,c.children("td").each(function(b){2===b?reportSettings($(this),d):3===b?haulSettings($(this),d):4===b?(hideRecentlyFarmed($(this),d),attackSettings($(this),d),continentSettings($(this),d)):5===b?hideTime($(this),d):6===b?scoutReportSettings($(this),d):7===b?wallSettings($(this),d):8===b?distanceSettings($(this),d):void 0}),!!hideRow&&(troubleshoot&&console.log(c.find("#rowNum").html()+": ("+reason.join(",")+")"),reason=[],!0)}function resetTable(){$("#plunder_list tr").each(function(){$(this).show()})}function setLocalStorageRow(c){var a="sitter:"+sitter+", village:"+c+", world:"+getURL()[0];$.jStorage.set(a,getCurrentGameTime())}function reportSettings(c,a){return 0<=c.html().indexOf("blue")&&a[s.blue]?(reason.push("Report is blue"),void(hideRow=!0)):0<=c.html().indexOf("green")&&a[s.green]?(reason.push("Report is green"),void(hideRow=!0)):0<=c.html().indexOf("yellow")&&a[s.yellow]?(reason.push("Report is yellow"),void(hideRow=!0)):0<=c.html().indexOf("red_yellow")&&a[s.red_yellow]?(reason.push("Report is red_yellow"),void(hideRow=!0)):0<=c.html().indexOf("red_blue")&&a[s.red_blue]?(reason.push("Report is red_blue"),void(hideRow=!0)):0<=c.html().indexOf("red")&&a[s.red]?(reason.push("Report is red"),void(hideRow=!0)):void 0}function haulSettings(c,a){if(a[s.enable_hauls]){if(0<=c.html().indexOf("max_loot/1")&&a[s.full])return reason.push("Haul is full"),void(hideRow=!0);if(0<=c.html().indexOf("max_loot/0")&&a[s.partial])return reason.push("Haul is partial"),void(hideRow=!0);if(-1==c.html().indexOf("max_loot")&&a[s.full])return reason.push("No haul graphic"),void(hideRow=!0)}}function hideRecentlyFarmed(e,a){if(a[s.hide_recent_farms]){var b=e.closest("tr").attr("name");localTitle="sitter:"+sitter+", village:"+b+", world:"+getURL()[0];var c=new Date($.jStorage.get(localTitle)),d=currentGameTime.getTime()-c.getTime(),f=Math.abs(parseInt(d/1e3/60));switch(a[s.sent_time_filter]){case"hide":if(f<parseInt(a[s.hide_recent_time]))return reason.push("Village was recently sent to "+f+" minutes ago"),void(hideRow=!0);break;case"show":if(f>parseInt(a[s.hide_recent_time]))return reason.push("Village was not recently sent to"),void(hideRow=!0);}}}function attackSettings(e,a){var b,f=e.find("img");if(b="undefined"==typeof f.prop("tooltipText")?0:parseInt(f.prop("tooltipText").replace(/\D/g,"")),a[s.enable_attacks])switch(a[s.attack_operator]){case"greater_than":if(b>parseInt(a[s.attack_value]))return reason.push("Outgoing attacks is too many"),void(hideRow=!0);break;case"less_than":if(b<parseInt(a[s.attack_value]))return reason.push("Outgoing attacks is too few"),void(hideRow=!0);break;case"equal_to":if(b==parseInt(a[s.attack_value]))return reason.push("Outgoing attacks is equal"),void(hideRow=!0);}}function continentSettings(e,a){var b=e.find("a").html();if("undefined"!=typeof b){b=b.substr(b.length-2);var f=a[s.continents_list].split(".");if(0<=$.inArray(b,f)&&"hide"==a[s.continent_display])return reason.push("Continent is set to hide"),void(hideRow=!0);if(-1==$.inArray(b,f)&&"show"==a[s.continent_display])return reason.push("Continent is not set to show"),void(hideRow=!0)}}function hideTime(c,a){if(a[s.enable_time]){var b=getVillageAttackedTime(c),d=currentGameTime.getTime()-b.getTime(),e=Math.abs(parseInt(d/1e3/60));switch(a[s.attack_time_filter]){case"hide":if(e<parseInt(a[s.time_value]))return reason.push("Village attacked "+e+" minutes ago."),void(hideRow=!0);break;case"show":if(e>parseInt(a[s.time_value]))return reason.push("Village attacked "+e+" minutes ago."),void(hideRow=!0);}}}function scoutReportSettings(g,a){var b;if(a[s.enable_scout]){if("?"==$.trim(g.find("span").html()))b=0;else{var h=parseInt(g.children("span").eq(0).html().replace(/\D+/g,"")),d=parseInt(g.children("span").eq(1).html().replace(/\D+/g,"")),e=parseInt(g.children("span").eq(2).html().replace(/\D+/g,""));b=h+d+e}switch(a[s.scout_report_operator]){case"greater_than":if(b>parseInt(a[s.haul_value]))return reason.push("Too many resources"),void(hideRow=!0);break;case"less_than":if(b<parseInt(a[s.haul_value]))return reason.push("Not enough resources"),void(hideRow=!0);break;case"equal_to":if(b==parseInt(a[s.haul_value]))return reason.push("Exact resources"),void(hideRow=!0);}}}function wallSettings(d,a){if(a[s.enable_walls]){var b=parseInt(d.html());switch("?"==b&&(b=0),$.trim(a[s.wall_operator])){case"greater_than":if(b>parseInt(a[s.wall_value]))return reason.push("Wall too high"),void(hideRow=!0);break;case"less_than":if(b<parseInt(a[s.wall_value]))return reason.push("Wall too low"),void(hideRow=!0);break;case"equal_to":if(b==parseInt(a[s.wall_value]))return reason.push("Wall is exact"),void(hideRow=!0);}}}function distanceSettings(d,a){if(a[s.enable_distances]){var b=d.html();switch($.trim(a[s.distance_operator])){case"greater_than":if(parseFloat(b)>parseFloat(a[s.distance_value]))return reason.push("Village too far"),void(hideRow=!0);break;case"less_than":if(parseFloat(b)<parseFloat(a[s.distance_value]))return reason.push("Village too close"),void(hideRow=!0);break;case"equal_to":if(parseFloat(b)==parseFloat(a[s.distance_value]))return reason.push("Village exact distance"),void(hideRow=!0);}}}function deleteRecentlyFarmed(){$("#am_widget_Farm tr:gt(0)").each(function(){$(this).children("td").each(function(b){4==b&&(reportLinkText=$.trim($(this).children("a").html()),localTitle="sitter:"+sitter+", village:"+reportLinkText+", world:"+getURL()[0],null!=$.jStorage.get(localTitle)&&$.jStorage.deleteKey(localTitle))})})}function getCurrentGameTime(){var c=$("#serverTime").html().split(":"),a=$("#serverDate").html().split("/");return new Date(a[2],a[1]-1,a[0],c[0],c[1],c[2],0)}function getVillageAttackedTime(n){for(var o,p,n,q=n.html(),r=q.split(" "),e=0;e<r.length;e++)n=$.trim(r[e]),-1<n.indexOf(".")?o=n:n==filter_61?o=filter_61:n==filter_62&&(o=filter_62),-1<n.indexOf(":")&&(p=n);if(o==filter_61||o==filter_62){var s=currentGameTime.getDate();o==filter_62&&s--;var t=currentGameTime.getMonth(),u=currentGameTime.getFullYear(),q=p.split(":"),v=q[0],w=q[1],x=q[2];return new Date(u,t,s,v,w,x,0)}var y=o.split("."),s=y[0],t=y[1]-1;if(0==currentGameTime.getMonth()&&11==t)var u=currentGameTime.getFullYear()-1;else var u=currentGameTime.getFullYear();var q=p.split(":"),v=q[0],w=q[1],x=q[2];return new Date(u,t,s,v,w,x,0)}function loadDefaultProfile(){null==$.jStorage.get("profile:"+profile_10)&&($.jStorage.set("profile:"+profile_10,["1","1","distance","asc",!1,!1,!1,!1,!1,!1,!1,!1,"hide","",!1,!1,!1,!1,"greater_than","",!1,"greater_than","",!1,"greater_than","",!1,"greater_than","","hide","",!1,"hide","",!1,!1,!1,"",!1,"",!1]),$.jStorage.deleteKey("profileList"),$.jStorage.set("profileList",[profile_10])),userset=$.jStorage.get("profile:"+profile_10),loadProfile(profile_10),$("#settingsProfile").val(profile_10)}function setDefaultProfile(){if($("#settingsProfile").val()==profile_10){var c=confirm(dialog_02);if(!c)return!1;createProfile(),setDefaultProfile()}else{var a=$.jStorage.get("profile:"+$("#settingsProfile").val());$.jStorage.set("profile:"+profile_10,a)}}function fillProfileList(){var b=$.jStorage.get("profileList");$.each(b,function(c,a){$("#settingsProfile").append("<option value='"+a+"'>"+a+"</option>")}),$("#settingsProfile").val($.jStorage.get("DefaultProfile"))}function createProfile(){var d=prompt(dialog_03+":");if(-1!=$.inArray(d,$.jStorage.get("profileList")))return alert(dialog_04),createProfile(),!1;if(""==d)return alert(dialog_05),createProfile(),!1;if(null!=d&&""!=d){var a=[];a.push($("#start_page").val()),a.push($("#end_page").val()),a.push($("#order_by").val()),a.push($("#direction").val()),a.push($("#all_none").prop("checked")),a.push($("#blue").prop("checked")),a.push($("#green").prop("checked")),a.push($("#yellow").prop("checked")),a.push($("#red_yellow").prop("checked")),a.push($("#red_blue").prop("checked")),a.push($("#red").prop("checked")),a.push($("#hide_recent_farms").prop("checked")),a.push($("#sent_time_filter").val()),a.push($("#hide_recent_time").val()),a.push($("#enable_hauls").prop("checked")),a.push($("#full").prop("checked")),a.push($("#partial").prop("checked")),a.push($("#enable_attacks").prop("checked")),a.push($("#attack_operator").val()),a.push($("#attack_value").val()),a.push($("#enable_walls").prop("checked")),a.push($("#wall_operator").val()),a.push($("#wall_value").val()),a.push($("#enable_distances").prop("checked")),a.push($("#distance_operator").val()),a.push($("#distance_value").val()),a.push($("#enable_scout").prop("checked")),a.push($("#scout_report_operator").val()),a.push($("#haul_value").val()),a.push($("#continent_display").val()),a.push($("#continents_list").val()),a.push($("#enable_time").prop("checked")),a.push($("#attack_time_filter").val()),a.push($("#time_value").val()),a.push($("#enable_auto_run").prop("checked")),a.push($("#next_village_no_farms").prop("checked")),a.push($("#next_village_scouts").prop("checked")),a.push($("#scouts_left").val()),a.push($("#next_village_farming_troops").prop("checked")),a.push($("#farming_troops_left").val()),a.push($("#next_village_units").prop("checked")),$.jStorage.set("profile:"+d,a);var b=$.jStorage.get("profileList");b.push(d),$.jStorage.set("profileList",b),$("#settingsProfile").append("<option value='"+d+"'>"+d+"</option>"),$("#priorityOneProfile").append("<option value='"+d+"'>"+d+"</option>"),$("#priorityTwoProfile").append("<option value='"+d+"'>"+d+"</option>"),$("#priorityThreeProfile").append("<option value='"+d+"'>"+d+"</option>"),$("#settingsProfile").val(d)}}function loadProfile(c){var a=$.jStorage.get("profile:"+c);userset=a,$("#start_page").val(a[0]),$("#end_page").val(a[1]),$("#order_by").val(a[2]),$("#direction").val(a[3]),$("#all_none").prop("checked",a[4]),$("#blue").prop("checked",a[5]),$("#green").prop("checked",a[6]),$("#yellow").prop("checked",a[7]),$("#red_yellow").prop("checked",a[8]),$("#red_blue").prop("checked",a[9]),$("#red").prop("checked",a[10]),$("#hide_recent_farms").prop("checked",a[11]),$("#sent_time_filter").val(a[12]),$("#hide_recent_time").val(a[13]),$("#enable_hauls").prop("checked",a[14]),$("#full").prop("checked",a[15]),$("#partial").prop("checked",a[16]),$("#enable_attacks").prop("checked",a[17]),$("#attack_operator").val(a[18]),$("#attack_value").val(a[19]),$("#enable_walls").prop("checked",a[20]),$("#wall_operator").val(a[21]),$("#wall_value").val(a[22]),$("#enable_distances").prop("checked",a[23]),$("#distance_operator").val(a[24]),$("#distance_value").val(a[25]),$("#enable_scout").prop("checked",a[26]),$("#scout_report_operator").val(a[27]),$("#haul_value").val(a[28]),$("#continent_display").val(a[29]),$("#continents_list").val(a[30]),$("#enable_time").prop("checked",a[31]),$("#attack_time_filter").val(a[32]),$("#time_value").val(a[33]),$("#enable_auto_run").prop("checked",a[34]),$("#next_village_no_farms").prop("checked",a[35]),$("#next_village_scouts").prop("checked",a[36]),$("#scouts_left").val(a[37]),$("#next_village_farming_troops").prop("checked",a[38]),$("#farming_troops_left").val(a[39]),$("#next_village_units").prop("checked",a[40])}function changeProfile(b){loadProfile(b),resetTable(),applyFilters()}function deleteProfile(){var c=$("#settingsProfile").val();if(c==profile_10)alert(dialog_06);else{var a=$.jStorage.get("profileList");a.splice(a.indexOf(c),1),$.jStorage.set("profileList",a),$.jStorage.deleteKey("profile:"+c),$("#settingsProfile option[value='"+c+"']").remove(),$("#priorityOneProfile option[value='"+c+"']").remove(),$("#priorityTwoProfile option[value='"+c+"']").remove(),$("#priorityThreeProfile option[value='"+c+"']").remove(),loadDefaultProfile(profile_10)}}function updateProfile(){var c=$("#settingsProfile").val(),a=[];a.push($("#start_page").val()),a.push($("#end_page").val()),a.push($("#order_by").val()),a.push($("#direction").val()),a.push($("#all_none").prop("checked")),a.push($("#blue").prop("checked")),a.push($("#green").prop("checked")),a.push($("#yellow").prop("checked")),a.push($("#red_yellow").prop("checked")),a.push($("#red_blue").prop("checked")),a.push($("#red").prop("checked")),a.push($("#hide_recent_farms").prop("checked")),a.push($("#sent_time_filter").val()),a.push($("#hide_recent_time").val()),a.push($("#enable_hauls").prop("checked")),a.push($("#full").prop("checked")),a.push($("#partial").prop("checked")),a.push($("#enable_attacks").prop("checked")),a.push($("#attack_operator").val()),a.push($("#attack_value").val()),a.push($("#enable_walls").prop("checked")),a.push($("#wall_operator").val()),a.push($("#wall_value").val()),a.push($("#enable_distances").prop("checked")),a.push($("#distance_operator").val()),a.push($("#distance_value").val()),a.push($("#enable_scout").prop("checked")),a.push($("#scout_report_operator").val()),a.push($("#haul_value").val()),a.push($("#continent_display").val()),a.push($("#continents_list").val()),a.push($("#enable_time").prop("checked")),a.push($("#attack_time_filter").val()),a.push($("#time_value").val()),a.push($("#enable_auto_run").prop("checked")),a.push($("#next_village_no_farms").prop("checked")),a.push($("#next_village_scouts").prop("checked")),a.push($("#scouts_left").val()),a.push($("#next_village_farming_troops").prop("checked")),a.push($("#farming_troops_left").val()),a.push($("#next_village_units").prop("checked")),$.jStorage.set("profile:"+c,a),userset=a}function exportProfile(){var c=$("#settingsProfile").val(),a=$.jStorage.get("profile:"+c);c==profile_10?alert(dialog_07):prompt(dialog_08,dialog_09A+""+c+dialog_09B+c+","+a+dialog_09C)}function importProfile(){var d=prompt(dialog_10+":",dialog_11);d=d.split(",");var e=d[0];d.shift();var b=$.jStorage.get("profileList");if(-1!=$.inArray(e,b))return alert(dialog_12),!1;for(i=0;i<=d.length;i++)("false"===d[i]||"true"===d[i])&&(d[i]=parseBool(d[i]));$.jStorage.set("profile:"+e,d),b.push(e),$.jStorage.set("profileList",b),$("#settingsProfile").append("<option value='"+e+"'>"+e+"</option>"),$("#settingsProfile").val(e),loadProfile(e)}function hotkeysOnOff(){$("#settingsBody tr:lt(9) input,#settingsBody tr:lt(9) select").focusin(function(){window.onkeydown=function(){}}),$("#settingsBody tr:lt(9) input,#settingsBody tr:lt(9) select").focusout(function(){turnOnHotkeys()})}function turnOnHotkeys(){window.onkeydown=function(f){if(editingKey)editKey(f);else{var a=$("#plunder_list tr").filter(":visible").eq(1),b=a.children("td").eq(9).children("a"),c=a.children("td").eq(10).children("a"),d=a.children("td").eq(11).children("a");switch(f.which){case keycodes.a:tryClick(b);break;case keycodes.b:tryClick(c);break;case keycodes.c:tryClick(d);break;case keycodes.skip:a.hide();break;case keycodes.master:cansend&&filtersApplied&&selectMasterButton(a);break;case keycodes.left:getNewVillage("p");break;case keycodes.right:getNewVillage("n");break;default:return;}}f.preventDefault()}}function tryClick(b){cansend&&filtersApplied&&(checkIfNextVillage()||(b.hasClass("farm_icon_disabled")||null==b.html()?(UI.ErrorMessage("That button is not selectable. Skipping row...",500),b.closest("tr").hide()):(b.click(),doTime(userset[s.next_village_scouts]||userset[s.next_village_farming_troops]?400:250))))}function doTime(b){cansend=!1,setTimeout(function(){cansend=!0},b)}function editKey(c){if(37>=c.keyCode&&40<=c.keyCode||48>=c.keyCode&&90<=c.keyCode)UI.ErrorMessage("You can only enter letters, numbers, or arrows. Plese try another key.",1500);else{var a=String.fromCharCode(c.keyCode);switch(37==c.keyCode&&(a="\u2190"),38==c.keyCode&&(a="\u2191"),39==c.keyCode&&(a="\u2192"),40==c.keyCode&&(a="\u2193"),keyToEdit){case"A":keycodes.a=c.keyCode,$("#hotkey_value_a").val(a);break;case"B":keycodes.b=c.keyCode,$("#hotkey_value_b").val(a);break;case"C":keycodes.c=c.keyCode,$("#hotkey_value_c").val(a);break;case"Master":keycodes.master=c.keyCode,$("#hotkey_value_master").val(a);break;case"Skip":keycodes.skip=c.keyCode,$("#hotkey_value_skip").val(a);break;case"Left":keycodes.left=c.keyCode,$("#hotkey_value_left").val(a);break;case"Right":keycodes.right=c.keyCode,$("#hotkey_value_right").val(a);break;default:return;}UI.SuccessMessage(a+" is now mapped to the "+keyToEdit+" button."),updateKeypressSettings(),editingKey=!1}}function updateKeypressSettings(){keyPressSettings.a_code=keycodes.a,keyPressSettings.a_char=$("#hotkey_value_a").val(),keyPressSettings.b_code=keycodes.b,keyPressSettings.b_char=$("#hotkey_value_b").val(),keyPressSettings.c_code=keycodes.c,keyPressSettings.c_char=$("#hotkey_value_c").val(),keyPressSettings.master_code=keycodes.master,keyPressSettings.master_char=$("#hotkey_value_master").val(),keyPressSettings.skip_code=keycodes.skip,keyPressSettings.skip_char=$("#hotkey_value_skip").val(),keyPressSettings.left_code=keycodes.left,keyPressSettings.left_char=$("#hotkey_value_left").val(),keyPressSettings.right_code=keycodes.right,keyPressSettings.right_char=$("#hotkey_value_right").val(),keyPressSettings.priorityOneEnabled=$("#priorityOneEnabled").prop("checked"),keyPressSettings.priorityOneProfile=$("#priorityOneProfile").val(),keyPressSettings.priorityOneButton=$("#priorityOneButton").val(),keyPressSettings.priorityTwoEnabled=$("#priorityTwoEnabled").prop("checked"),keyPressSettings.priorityTwoProfile=$("#priorityTwoProfile").val(),keyPressSettings.priorityTwoButton=$("#priorityTwoButton").val(),keyPressSettings.priorityThreeEnabled=$("#priorityThreeEnabled").prop("checked"),keyPressSettings.priorityThreeProfile=$("#priorityThreeProfile").val(),keyPressSettings.priorityThreeButton=$("#priorityThreeButton").val(),keyPressSettings.defaultButton=$("#defaultButton").val(),$.jStorage.set("keyPressSettings",keyPressSettings)}function fillKeypressSettings(){null==$.jStorage.get("keyPressSettings")&&$.jStorage.set("keyPressSettings",keyPressSettings),keyPressSettings=$.jStorage.get("keyPressSettings"),keycodes.a=keyPressSettings.a_code,$("#hotkey_value_a").val(keyPressSettings.a_char),keycodes.b=keyPressSettings.b_code,$("#hotkey_value_b").val(keyPressSettings.b_char),keycodes.c=keyPressSettings.c_code,$("#hotkey_value_c").val(keyPressSettings.c_char),keycodes.master=keyPressSettings.master_code,$("#hotkey_value_master").val(keyPressSettings.master_char),keycodes.skip=keyPressSettings.skip_code,$("#hotkey_value_skip").val(keyPressSettings.skip_char),keycodes.left=keyPressSettings.left_code,$("#hotkey_value_left").val(keyPressSettings.left_char),keycodes.right=keyPressSettings.right_code,$("#hotkey_value_right").val(keyPressSettings.right_char),$("#priorityOneEnabled").prop("checked",keyPressSettings.priorityOneEnabled),$("#priorityOneProfile").val(keyPressSettings.priorityOneProfile),$("#priorityOneButton").val(keyPressSettings.priorityOneButton),$("#priorityTwoEnabled").prop("checked",keyPressSettings.priorityTwoEnabled),$("#priorityTwoProfile").val(keyPressSettings.priorityTwoProfile),$("#priorityTwoButton").val(keyPressSettings.priorityTwoButton),$("#priorityThreeEnabled").prop("checked",keyPressSettings.priorityThreeEnabled),$("#priorityThreeProfile").val(keyPressSettings.priorityThreeProfile),$("#priorityThreeButton").val(keyPressSettings.priorityThreeButton),$("#defaultButton").val(keyPressSettings.defaultButton)}function setKeyEditMode(b){return editingKey=!0,keyToEdit=b,UI.InfoMessage("Press any number, letter, or arrow key to set the hotkey for the <span style='font-weight:bold;'>"+b+"</span> button",1500),!1}function fillMasterSettings(){var b=$.jStorage.get("profileList");$.each(b,function(c,a){$("#priorityOneProfile").append("<option value='"+a+"'>"+a+"</option>"),$("#priorityTwoProfile").append("<option value='"+a+"'>"+a+"</option>"),$("#priorityThreeProfile").append("<option value='"+a+"'>"+a+"</option>")})}function selectMasterButton(j){var a,k=$.jStorage.get("profile:"+keyPressSettings.priorityOneProfile),c=$.jStorage.get("profile:"+keyPressSettings.priorityTwoProfile),d=$.jStorage.get("profile:"+keyPressSettings.priorityThreeProfile),e=j.children("td").eq(9).children("a"),f=j.children("td").eq(10).children("a"),g=j.children("td").eq(11).children("a");switch(a=keyPressSettings.defaultButton,keyPressSettings.priorityThreeEnabled&&!checkRowToHide(j,d)&&(a=keyPressSettings.priorityThreeButton),keyPressSettings.priorityTwoEnabled&&!checkRowToHide(j,c)&&(a=keyPressSettings.priorityTwoButton),keyPressSettings.priorityOneEnabled&&!checkRowToHide(j,k)&&(a=keyPressSettings.priorityOneButton),a){case"A":tryClick(e);break;case"B":tryClick(f);break;case"C":tryClick(g);break;default:j.hide();}}function setDefaultLanguage(){var c=getURL();3==c.length&&c.shift();var a=c.join(".");"fyletikesmaxes.gr"===a?$.jStorage.set("language","el"):"guerrastribales.es"===a?$.jStorage.set("language","es"):"tribalwars.ae"===a?$.jStorage.set("language","ar"):"divokekmeny.cz"===a?$.jStorage.set("language","cs"):$.jStorage.set("language","en")}function loadLanguage(e){$.jStorage.set("language",e);var f=$.jStorage.get("profileList"),b=$.jStorage.get("profile:"+profile_10);0>$.inArray(e,availableLangs)&&(e="en");var c=scriptURL+"lang/"+e+".js";$.getScript(c,function(){$("#settingsDiv").remove(),f[0]=profile_10,$.jStorage.set("profileList",f),$.jStorage.set("profile:"+profile_10,b),changeHeader(filter_40),showSettings()})}function addLanguages(){$("#language").append("<option value='cs'>\u010Ce\u0161tina</option>"),$("#language").append("<option value='en'>English</option>"),$("#language").append("<option value='el'>\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC</option>"),$("#language").append("<option value='es'>Espa\xF1ol</option>"),$("#language").append("<option value='ar'>\u0627\u0644\u0644\u063A\u0629 \u0627\u0644\u0639\u0631\u0628\u064A\u0629</option>")}function parseBool(b){return"undefined"!=typeof b&&"true"===b.replace(/^\s+|\s+$/g,"").toLowerCase()}function getURL(){var b=window.location.hostname;return b=b.split(".")}function checkPage(){"am_farm"===window.game_data.screen?run():getFA()}function getFA(){fadeThanksToCheese(),openLoader();var b=link[0]+window.game_data.village.id+link[1];$.getScript("https://"+window.location.host+"/js/game/Accountmanager.js",function(){$.ajax({type:"GET",url:b,dataType:"html",error:function(d,a,b){alert("Get LA error: "+b),$("#fader").remove(),$("#loaders").remove()},success:function(d){var a=$(d),b=d.split("<title>")[1].split("</title>")[0];window.game_data=$.parseJSON(d.split("var game_data = ")[1].split("};")[0]+"}"),$("#header_info").html($("#header_info",a).html()),$("#topContainer").html($("#topContainer",a).html()),$("#contentContainer").html($("#contentContainer",a).html()),$("head").find("title").html(b),$("#fader").remove(),$("#loaders").remove(),run()}})})}function fadeThanksToCheese(){var b=document.createElement("div");b.id="fader",b.style.position="fixed",b.style.height="100%",b.style.width="100%",b.style.backgroundColor="black",b.style.top="0px",b.style.left="0px",b.style.opacity="0.6",b.style.zIndex="12000",document.body.appendChild(b)}function openLoader(){var b=document.createElement("div");b.id="loaders",b.style.position="fixed",b.style.width="24px",b.style.height="24px",b.style.top="50%",b.style.left="50%",$(b).css("margin-left","-12px"),$(b).css("margin-top","-12px"),b.style.zIndex=13e3,$(b).append($("<img src='graphic/throbber.gif' height='24' width='24'></img>")),$("#contentContainer").append($(b))}function makeItPretty(){$(".row_a").css("background-color","rgb(216, 255, 216)"),$("#plunder_list").find("tr:gt(0)").each(function(b){$(this).removeClass("row_a"),$(this).removeClass("row_b"),0==b%2?$(this).addClass("row_a"):$(this).addClass("row_b")}),hideStuffs()}function hideStuffs(){$("#plunder_list").hide(),$("#plunder_list_nav").hide(),$("#contentContainer").find("div[class=\"vis\"]").eq(0).children().eq(0).append($("<div class='vis' style='float:right;text-align:center;line-height:100%;width:12px;height:12px;margin:0px 0px 0px 0px;position:relative;background-color:tan;opacity:.7'><a href='#' num='0' onclick='uglyHider($(this));return false;'>+</a></div>")),$("#contentContainer").find("div[class=\"vis\"]").eq(0).children().eq(1).hide(),$("#am_widget_Farm").find("h4").eq(0).append($("<div class='vis' style='float:right;text-align:center;line-height:100%;width:12px;height:12px;margin:0px 0px 0px 0px;position:relative;background-color:tan;opacity:.7'><a href='#' num='1' onclick='uglyHider($(this));return false;'>+</a></div>")),$("#plunder_list_filters").hide()}function uglyHider(c){var a;a=0<$("#settingsBody").length?2:1,"+"===$(c).text()?$(c).text("-"):$(c).text("+"),0==parseInt($(c).attr("num"))?$("#contentContainer").find("div[class=\"vis\"]").eq(a).children().eq(1).toggle():1==parseInt($(c).attr("num"))?$("#plunder_list_filters").toggle():2==parseInt($(c).attr("num"))&&$("#settingsBody").toggle()}!function(){"use strict";function q(){var d=!1;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),d=!0,window.localStorage.removeItem("_tmptest")}catch(a){}if(d)try{window.localStorage&&(s=window.localStorage,K="localStorage",M=s.jStorage_update)}catch(a){}else if("globalStorage"in window)try{window.globalStorage&&(s="localhost"==window.location.hostname?window.globalStorage["localhost.localdomain"]:window.globalStorage[window.location.hostname],K="globalStorage",M=s.jStorage_update)}catch(a){}else{if(I=document.createElement("link"),!I.addBehavior)return void(I=null);I.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(I);try{I.load("jStorage")}catch(a){I.setAttribute("jStorage","{}"),I.save("jStorage"),I.load("jStorage")}var f="{}";try{f=I.getAttribute("jStorage")}catch(a){}try{M=I.getAttribute("jStorage_update")}catch(a){}s.jStorage=f,K="userDataBehavior"}e(),H(),b(),j(),"addEventListener"in window&&window.addEventListener("pageshow",function(b){b.persisted&&c()},!1)}function F(){var b="{}";if("userDataBehavior"==K){I.load("jStorage");try{b=I.getAttribute("jStorage")}catch(a){}try{M=I.getAttribute("jStorage_update")}catch(a){}s.jStorage=b}e(),H(),j()}function b(){"localStorage"==K||"globalStorage"==K?"addEventListener"in window?window.addEventListener("storage",c,!1):document.attachEvent("onstorage",c):"userDataBehavior"==K&&setInterval(c,1e3)}function c(){var b;clearTimeout(z),z=setTimeout(function(){if("localStorage"==K||"globalStorage"==K)b=s.jStorage_update;else if("userDataBehavior"==K){I.load("jStorage");try{b=I.getAttribute("jStorage_update")}catch(a){}}b&&b!=M&&(M=b,d())},25)}function d(){var b,f=o.parse(o.stringify(r.__jstorage_meta.CRC32));F(),b=o.parse(o.stringify(r.__jstorage_meta.CRC32));var c,h=[],e=[];for(c in f)if(f.hasOwnProperty(c)){if(!b[c]){e.push(c);continue}f[c]!=b[c]&&"2."==(f[c]+"").substr(0,2)&&h.push(c)}for(c in b)b.hasOwnProperty(c)&&(f[c]||h.push(c));G(h,"updated"),G(e,"deleted")}function G(h,j){h=[].concat(h||[]);var k,l,m,n;if("flushed"==j){for(var o in h=[],L)L.hasOwnProperty(o)&&h.push(o);j="deleted"}for(k=0,m=h.length;m>k;k++){if(L[h[k]])for(l=0,n=L[h[k]].length;n>l;l++)L[h[k]][l](h[k],j);if(L["*"])for(l=0,n=L["*"].length;n>l;l++)L["*"][l](h[k],j)}}function f(){var b=(+new Date).toString();if("localStorage"==K||"globalStorage"==K)try{s.jStorage_update=b}catch(a){K=!1}else"userDataBehavior"==K&&(I.setAttribute("jStorage_update",b),I.save("jStorage"));c()}function e(){if(s.jStorage)try{r=o.parse(s.jStorage+"")}catch(b){s.jStorage="{}"}else s.jStorage="{}";J=s.jStorage?(s.jStorage+"").length:0,r.__jstorage_meta||(r.__jstorage_meta={}),r.__jstorage_meta.CRC32||(r.__jstorage_meta.CRC32={})}function g(){a();try{s.jStorage=o.stringify(r),I&&(I.setAttribute("jStorage",s.jStorage),I.save("jStorage")),J=s.jStorage?(s.jStorage+"").length:0}catch(b){}}function h(b){if("string"!=typeof b&&"number"!=typeof b)throw new TypeError("Key name must be string or numeric");if("__jstorage_meta"==b)throw new TypeError("Reserved key name");return!0}function H(){var k,l,m,n,o=1/0,q=!1,s=[];if(clearTimeout(p),r.__jstorage_meta&&"object"==typeof r.__jstorage_meta.TTL){for(l in k=+new Date,m=r.__jstorage_meta.TTL,n=r.__jstorage_meta.CRC32,m)m.hasOwnProperty(l)&&(m[l]<=k?(delete m[l],delete n[l],delete r[l],q=!0,s.push(l)):m[l]<o&&(o=m[l]));o!=1/0&&(p=setTimeout(H,Math.min(o-k,2147483647))),q&&(g(),f(),G(s,"deleted"))}}function j(){var f,g;if(r.__jstorage_meta.PubSub){var h,j=C,l=[];for(f=g=r.__jstorage_meta.PubSub.length-1;0<=f;f--)h=r.__jstorage_meta.PubSub[f],h[0]>C&&(j=h[0],l.unshift(h));for(f=l.length-1;0<=f;f--)k(l[f][1],l[f][2]);C=j}}function k(e,a){if(N[e])for(var b=0,f=N[e].length;f>b;b++)try{N[e][b](e,o.parse(o.stringify(a)))}catch(a){}}function a(){if(r.__jstorage_meta.PubSub){for(var d=+new Date-2e3,a=0,e=r.__jstorage_meta.PubSub.length;e>a;a++)if(r.__jstorage_meta.PubSub[a][0]<=d){r.__jstorage_meta.PubSub.splice(a,r.__jstorage_meta.PubSub.length-a);break}r.__jstorage_meta.PubSub.length||delete r.__jstorage_meta.PubSub}}function l(c,a){r.__jstorage_meta||(r.__jstorage_meta={}),r.__jstorage_meta.PubSub||(r.__jstorage_meta.PubSub=[]),r.__jstorage_meta.PubSub.unshift([+new Date,c,a]),g(),f()}function m(g,a){for(var b,h=g.length,j=a^h,k=0;4<=h;)b=255&g.charCodeAt(k)|(255&g.charCodeAt(++k))<<8|(255&g.charCodeAt(++k))<<16|(255&g.charCodeAt(++k))<<24,b=1540483477*(65535&b)+((65535&1540483477*(b>>>16))<<16),b^=b>>>24,b=1540483477*(65535&b)+((65535&1540483477*(b>>>16))<<16),j=1540483477*(65535&j)+((65535&1540483477*(j>>>16))<<16)^b,h-=4,++k;switch(h){case 3:j^=(255&g.charCodeAt(k+2))<<16;case 2:j^=(255&g.charCodeAt(k+1))<<8;case 1:j^=255&g.charCodeAt(k),j=1540483477*(65535&j)+((65535&1540483477*(j>>>16))<<16);}return j^=j>>>13,j=1540483477*(65535&j)+((65535&1540483477*(j>>>16))<<16),j^=j>>>15,j>>>0}var n=window.jQuery||window.$||(window.$={}),o={parse:window.JSON&&(window.JSON.parse||window.JSON.decode)||String.prototype.evalJSON&&function(b){return(b+"").evalJSON()}||n.parseJSON||n.evalJSON,stringify:Object.toJSON||window.JSON&&(window.JSON.stringify||window.JSON.encode)||n.toJSON};if("function"!=typeof o.parse||"function"!=typeof o.stringify)throw new Error("No JSON support found, include //cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2.js to page");var p,r={__jstorage_meta:{CRC32:{}}},s={jStorage:"{}"},I=null,J=0,K=!1,L={},z=!1,M=0,N={},C=+new Date,O={isXML:function(c){var a=(c?c.ownerDocument||c:0).documentElement;return!!a&&"HTML"!==a.nodeName},encode:function(b){if(!this.isXML(b))return!1;try{return new XMLSerializer().serializeToString(b)}catch(a){try{return b.xml}catch(a){}}return!1},decode:function(d){var a,e="DOMParser"in window&&new DOMParser().parseFromString||window.ActiveXObject&&function(c){var a=new ActiveXObject("Microsoft.XMLDOM");return a.async="false",a.loadXML(c),a};return!!e&&(a=e.call("DOMParser"in window&&new DOMParser||window,d,"text/xml"),!!this.isXML(a)&&a)}};n.jStorage={version:"0.4.12",set:function(d,a,e){if(h(d),e=e||{},"undefined"==typeof a)return this.deleteKey(d),a;if(O.isXML(a))a={_is_xml:!0,xml:O.encode(a)};else{if("function"==typeof a)return;a&&"object"==typeof a&&(a=o.parse(o.stringify(a)))}return r[d]=a,r.__jstorage_meta.CRC32[d]="2."+m(o.stringify(a),2538058380),this.setTTL(d,e.TTL||0),G(d,"updated"),a},get:function(c,a){return h(c),c in r?r[c]&&"object"==typeof r[c]&&r[c]._is_xml?O.decode(r[c].xml):r[c]:"undefined"==typeof a?null:a},deleteKey:function(b){return h(b),!!(b in r)&&(delete r[b],"object"==typeof r.__jstorage_meta.TTL&&b in r.__jstorage_meta.TTL&&delete r.__jstorage_meta.TTL[b],delete r.__jstorage_meta.CRC32[b],g(),f(),G(b,"deleted"),!0)},setTTL:function(d,a){var e=+new Date;return h(d),a=+a||0,!!(d in r)&&(r.__jstorage_meta.TTL||(r.__jstorage_meta.TTL={}),0<a?r.__jstorage_meta.TTL[d]=e+a:delete r.__jstorage_meta.TTL[d],g(),H(),f(),!0)},getTTL:function(d){var a,e=+new Date;return h(d),d in r&&r.__jstorage_meta.TTL&&r.__jstorage_meta.TTL[d]?(a=r.__jstorage_meta.TTL[d]-e,a||0):0},flush:function(){return r={__jstorage_meta:{CRC32:{}}},g(),f(),G(null,"flushed"),!0},storageObj:function(){function b(){}return b.prototype=r,new b},index:function(){var c,d=[];for(c in r)r.hasOwnProperty(c)&&"__jstorage_meta"!=c&&d.push(c);return d},storageSize:function(){return J},currentBackend:function(){return K},storageAvailable:function(){return!!K},listenKeyChange:function(c,a){h(c),L[c]||(L[c]=[]),L[c].push(a)},stopListening:function(d,a){if(h(d),L[d]){if(!a)return void delete L[d];for(var b=L[d].length-1;0<=b;b--)L[d][b]==a&&L[d].splice(b,1)}},subscribe:function(c,d){if(c=(c||"").toString(),!c)throw new TypeError("Channel not defined");N[c]||(N[c]=[]),N[c].push(d)},publish:function(c,d){if(c=(c||"").toString(),!c)throw new TypeError("Channel not defined");l(c,d)},reInit:function(){F()},noConflict:function(b){return delete window.$.jStorage,b&&(window.jStorage=this),this}},q()}();var keyToEdit,current_units,version="1.10",scriptName="LA Enhancer",scriptURL="https://ntoombs19.github.io/LA-Enhancer/",updateNotesURL="http://forum.tribalwars.net/showthread.php?266604-ntoombs19-s-FA-Filter&p=6785655&viewfull=1#post6785655",working=!0,resourcesLoaded=!1,scriptLoaded=!1,pagesLoaded=!1,filtersApplied=!1,cansend=!0,keySetMode=!1,hideRow=!1,editingKey=!1,troubleshoot=!1,clearProfiles=!1,reason=[],currentGameTime=getCurrentGameTime(),sitter="";"0"!=window.game_data.player.sitter&&(sitter="t="+window.game_data.player.id+"&");var userset,link=["https://"+window.location.host+"/game.php?"+sitter+"village=","&screen=am_farm"],s={start_page:0,end_page:1,order_by:2,direction:3,all_none:4,blue:5,green:6,yellow:7,red_yellow:8,red_blue:9,red:10,hide_recent_farms:11,sent_time_filter:12,hide_recent_time:13,enable_hauls:14,full:15,partial:16,enable_attacks:17,attack_operator:18,attack_value:19,enable_walls:20,wall_operator:21,wall_value:22,enable_distances:23,distance_operator:24,distance_value:25,enable_scout:26,scout_report_operator:27,haul_value:28,continent_display:29,continents_list:30,enable_time:31,attack_time_filter:32,time_value:33,enable_auto_run:34,next_village_no_farms:35,next_village_scouts:36,scouts_left:37,next_village_farming_troops:38,farming_troops_left:39,next_village_units:40},keycodes={a:65,b:66,c:67,skip:83,right:39,left:37,master:77},keyPressSettings={a_code:65,a_char:"A",b_code:66,b_char:"B",c_code:67,c_char:"C",master_code:77,master_char:"M",skip_code:83,skip_char:"S",left_code:37,left_char:"\u2190",right_code:39,right_char:"\u2192",priorityOneEnabled:!0,priorityOneProfile:"Default",priorityOneButton:"Skip",priorityTwoEnabled:!0,priorityTwoProfile:"Default",priorityTwoButton:"Skip",priorityThreeEnabled:!0,priorityThreeProfile:"Default",priorityThreeButton:"Skip",defaultButton:"Skip"},availableLangs=["en","es","el","ar","cs"];null==$.jStorage.get("language")&&setDefaultLanguage(),$.getScript("https://ntoombs19.github.io/LA-Enhancer/lang/"+$.jStorage.get("language")+".js",function(){checkPage()}),$(document).off();
